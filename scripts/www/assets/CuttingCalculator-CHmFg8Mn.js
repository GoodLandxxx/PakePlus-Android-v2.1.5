import{d as ft,h as nt,i as J,j as wt,k as K,u as yt,c as S,a as k,b as l,A as gt,l as pt,w as H,F as Q,r as Z,t as V,n as tt,o as B,f as z,v as F,m as _t,g as lt,_ as bt}from"./index-C-yXZlVN.js";import{F as L}from"./FormRow-DdkG5DgU.js";import{P as at}from"./PrimaryButton-CbN-5kpj.js";const xt={class:"calculator-page"},Ct={class:"content"},Mt={class:"form-card"},St={key:0,class:"specs-scroller"},kt=["onClick"],Bt={class:"small-board-item"},Pt={class:"result-area"},Ut={class:"visualization"},Rt={class:"vis-label"},Wt={class:"vis-label-y"},At={class:"result-list-container"},Ht={class:"res-label"},Vt={class:"res-value"},$t={class:"total-result"},It={class:"actions"},Nt=ft({__name:"CuttingCalculator",setup(zt){const m=nt({width:1e3,length:1e3}),O=J([]),it=()=>{try{const s=localStorage.getItem("machining_common_specs");s&&(O.value=JSON.parse(s))}catch(s){console.error(s)}},ct=s=>{m.width=s.width,m.length=s.length};wt(()=>{it()});const _=nt({width:200,length:100}),G=J(0),C=J([]),rt=K(()=>C.value.reduce((s,t)=>s+t.count,0)),b=J([]),ut=K(()=>({aspectRatio:"1",display:"flex",justifyContent:"center",alignItems:"center"})),dt=K(()=>{const s=m.width||1,t=m.length||1,e=s/t;return e>=1?{width:"100%",aspectRatio:`${e}`}:{height:"100%",aspectRatio:`${e}`}}),et=(s,t,e,o)=>{const x=Math.floor(s/e),a=Math.floor(t/o),u=x*a,v=Math.floor(s/o),d=Math.floor(t/e),n=v*d;return n>u?{count:n,cols:v,rows:d,rotated:!0,itemW:o,itemL:e}:{count:u,cols:x,rows:a,rotated:!1,itemW:e,itemL:o}},st=(s,t,e,o,x)=>{const a=Math.floor(s/e),u=Math.floor(t/o),v=Math.floor(s/o),d=Math.floor(t/e);let n=null,M=1/0;const P=(h,w,U,R,i)=>{if(h*w===0)return;const c=h*w,y=Math.min(c,x),f=Math.ceil(y/h),r=(y<h?y:h)*U,g=f*R,p=r*g;(p<M||p===M&&y>(n?.count||0))&&(M=p,n={count:y,wUsed:r,hUsed:g,itemW:U,itemL:R,cols:h,rows:w,rotated:i,neededRows:f,lastRowItems:y%h})};return P(a,u,e,o,!1),P(v,d,o,e,!0),n},X=yt(),ht=()=>{if(!m.width||!m.length){X.showModal({title:"错误",content:"请输入大板尺寸",type:"error"});return}if(!_.width||!_.length){X.showModal({title:"错误",content:"请输入小板尺寸",type:"error"});return}b.value=[],C.value=[];const s=m.width,t=m.length,e=_.width,o=_.length,x=G.value;if(x<=0){const a=et(s,t,e,o);if(a.count>0){const u=a.cols*a.itemW,v=a.rows*a.itemL,d=(i,c,y,f)=>{if(i<=0||c<=0)return{count:0,rects:[]};const r=et(i,c,e,o);if(r.count===0)return{count:0,rects:[]};const g=r.cols*r.itemW,p=r.rows*r.itemL,W={x:y/s*100,y:f/t*100,width:g,height:p,wPct:g/s*100,hPct:p/t*100,gridW:100/r.cols,gridH:100/r.rows,isSecondary:!0};return{count:r.count,rects:[W]}},n=d(s-u,t,u,0),M=d(u,t-v,0,v),P=a.count+n.count+M.count,h=d(s,t-v,0,v),w=d(s-u,v,u,0),U=a.count+h.count+w.count,R=P>=U;b.value.push({x:0,y:0,width:u,height:v,wPct:u/s*100,hPct:v/t*100,gridW:100/a.cols,gridH:100/a.rows,isSecondary:!1}),R?(b.value.push(...n.rects),b.value.push(...M.rects)):(b.value.push(...h.rects),b.value.push(...w.rects)),C.value=[{count:Math.max(P,U)}]}else C.value=[{count:0}]}else{let a=null,u=1/0;const v=(d,n)=>{const M=Math.floor(s/d),P=Math.floor(t/n);for(let h=0;h<=M;h++)for(let w=0;w<=P;w++){const U=h*w,R=x-U,i=h*d,c=w*n;if(R<=0){const f=i*c;f<u&&f>0&&(u=f,a={main:{x:0,y:0,w:i,h:c,c:h,r:w,itemW:d,itemL:n},subs:[]});continue}const y=(f,r)=>{let g=R;const p=st(f.w,f.h,e,o,g);let W=0,$=0,j=0,D=null;p&&(W=p.count,$=p.wUsed,j=p.hUsed,D=p,g-=W);let I=0,N=0,T=0,E=null;if(g>0){const A=st(r.w,r.h,e,o,g);A&&(I=A.count,N=A.wUsed,T=A.hUsed,E=A,g-=I)}if(g<=0){const A=Math.max(i,W>0?f.x+$:0,I>0?r.x+N:0),vt=Math.max(c,W>0?f.y+j:0,I>0?r.y+T:0),ot=A*vt;if(ot<u){u=ot;const Y=[];if(W>0&&D){const q=$/D.itemW;Y.push({x:f.x/s*100,y:f.y/t*100,width:$,height:j,wPct:$/s*100,hPct:j/t*100,gridW:100/(q||1),gridH:100/(D.neededRows||1),isSecondary:!0})}if(I>0&&E){const q=N/E.itemW;Y.push({x:r.x/s*100,y:r.y/t*100,width:N,height:T,wPct:N/s*100,hPct:T/t*100,gridW:100/(q||1),gridH:100/(E.neededRows||1),isSecondary:!0})}a={main:{x:0,y:0,w:i,h:c,c:h,r:w,itemW:d,itemL:n},subs:Y}}}};y({x:i,y:0,w:s-i,h:t},{x:0,y:c,w:i,h:t-c}),y({x:0,y:c,w:s,h:t-c},{x:i,y:0,w:s-i,h:c}),y({x:0,y:c,w:i,h:t-c},{x:i,y:0,w:s-i,h:t}),y({x:i,y:0,w:s-i,h:c},{x:0,y:c,w:s,h:t-c})}};if(v(e,o),v(o,e),a){const d=a,n=d.main;n.w>0&&n.h>0&&b.value.push({x:0,y:0,width:n.w,height:n.h,wPct:n.w/s*100,hPct:n.h/t*100,gridW:100/(n.c||1),gridH:100/(n.r||1),isSecondary:!1}),b.value.push(...d.subs),C.value=[{count:x}]}else X.showModal({title:"计算失败",content:"无法在给定尺寸内切出目标数量",type:"warning"}),C.value=[{count:0}]}},mt=()=>{m.width=1e3,m.length=1e3,_.width=200,_.length=100,G.value=0,C.value=[],b.value=[]};return(s,t)=>(B(),S("div",xt,[k(gt,{title:"切板计算","show-arrow":""}),l("div",Ct,[l("div",Mt,[k(L,{label:"宽 度：",unit:"mm"},{default:H(()=>[z(l("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>m.width=e),type:"number"},null,512),[[F,m.width,void 0,{number:!0}]])]),_:1}),k(L,{label:"长 度：",unit:"mm"},{default:H(()=>[z(l("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>m.length=e),type:"number"},null,512),[[F,m.length,void 0,{number:!0}]])]),_:1}),O.value.length>0?(B(),S("div",St,[(B(!0),S(Q,null,Z(O.value,(e,o)=>(B(),S("div",{key:o,class:"spec-tag",onClick:x=>ct(e)},V(e.width)+"×"+V(e.length),9,kt))),128))])):pt("",!0),t[5]||(t[5]=l("div",{class:"section-title"},[l("span",null,"小板设置")],-1)),l("div",Bt,[k(L,{label:"宽 度：",unit:"mm"},{default:H(()=>[z(l("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>_.width=e),type:"number"},null,512),[[F,_.width,void 0,{number:!0}]])]),_:1}),k(L,{label:"长 度：",unit:"mm"},{default:H(()=>[z(l("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>_.length=e),type:"number"},null,512),[[F,_.length,void 0,{number:!0}]])]),_:1}),k(L,{label:"目标数量：",unit:"块"},{default:H(()=>[z(l("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>G.value=e),type:"number",placeholder:"0为计算最多"},null,512),[[F,G.value,void 0,{number:!0}]])]),_:1})])]),l("div",Pt,[l("div",Ut,[l("div",Rt,V(m.width)+"mm",1),l("div",{class:"vis-box",style:tt(ut.value)},[l("div",{class:"vis-board",style:tt(dt.value)},[(B(!0),S(Q,null,Z(b.value,(e,o)=>(B(),S("div",{key:o,class:_t(["utilized-area",{"show-grid":!0,secondary:e.isSecondary}]),style:tt({left:`${e.x}%`,top:`${e.y}%`,width:`${e.wPct}%`,height:`${e.hPct}%`,backgroundSize:`${e.gridW}% ${e.gridH}%`})},null,6))),128))],4)],4),l("div",Wt,V(m.length)+"mm",1)]),l("div",At,[t[6]||(t[6]=l("div",{class:"result-title"},"切割结果",-1)),(B(!0),S(Q,null,Z(C.value,(e,o)=>(B(),S("div",{key:o,class:"result-row"},[l("div",Ht,"小板"+V(o+1),1),l("div",Vt,V(e.count)+" 块",1)]))),128)),l("div",$t," 总计: "+V(rt.value)+" 块 ",1)])]),l("div",It,[k(at,{type:"secondary",onClick:mt},{default:H(()=>[...t[7]||(t[7]=[lt("清空",-1)])]),_:1}),k(at,{type:"primary",onClick:ht},{default:H(()=>[...t[8]||(t[8]=[lt("计算",-1)])]),_:1})])])]))}}),jt=bt(Nt,[["__scopeId","data-v-cb04f88a"]]);export{jt as default};
